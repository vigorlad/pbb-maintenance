"""
============================================================
app.py - ì¸ì²œê³µí•­ ìš´í•­í˜„í™© PBB_MT ë©”ì¸ ì§„ì…ì 
============================================================
ì´ íŒŒì¼ì€ Streamlit ì•±ì˜ ì‹œì‘ì ì…ë‹ˆë‹¤.
í˜ì´ì§€ ì„¤ì •, ìŠ¤íƒ€ì¼ ì ìš©, íƒ­ êµ¬ì„±ë§Œ ë‹´ë‹¹í•˜ë©°,
ì‹¤ì œ ê¸°ëŠ¥ì€ ê° ëª¨ë“ˆì— ìœ„ì„í•©ë‹ˆë‹¤.

ì‹¤í–‰ ë°©ë²•:
  streamlit run app.py

ëª¨ë“ˆ êµ¬ì¡°:
  app.py (ì—¬ê¸°)       â†’ ì•± ì¡°ë¦½ ë° ì‹¤í–‰
  â”œâ”€â”€ config.py       â†’ ì„¤ì •/ìƒìˆ˜ (APIí‚¤, í„°ë¯¸ë„ ì •ë³´, íƒ€ì„ì¡´ ë“±)
  â”œâ”€â”€ api.py          â†’ ì¸ì²œê³µí•­ ê³µê³µë°ì´í„° API í˜¸ì¶œ
  â”œâ”€â”€ utils.py        â†’ ë‚ ì§œ/ì‹œê°„ í¬ë§· ë³€í™˜ ìœ í‹¸ë¦¬í‹°
  â”œâ”€â”€ excel_export.py â†’ ì—‘ì…€ íŒŒì¼ ìƒì„± (ìŠ¤íƒ€ì¼, ì‹œíŠ¸ ì‘ì„±)
  â”œâ”€â”€ ui_styles.py    â†’ CSS ìŠ¤íƒ€ì¼ ì •ì˜
  â”œâ”€â”€ ui_gate_search.py    â†’ íƒ­1: ê²Œì´íŠ¸ ì¶œë„ì°© ì¡°íšŒ UI
  â””â”€â”€ ui_excel_download.py â†’ íƒ­2: ì—‘ì…€ ë‹¤ìš´ë¡œë“œ UI
============================================================
"""

import streamlit as st
from datetime import datetime, timedelta

import config
import ui_styles
import ui_gate_search
import ui_excel_download

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1) API í‚¤ ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Streamlit Cloud ë°°í¬ ì‹œ st.secretsì— SERVICE_KEYë¥¼ ë“±ë¡í•˜ë©´
# í™˜ê²½ë³€ìˆ˜ ëŒ€ì‹  secrets ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
try:
    if "SERVICE_KEY" in st.secrets:
        config.SERVICE_KEY = st.secrets["SERVICE_KEY"]
except Exception:
    pass

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2) í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(
    page_title="ì¸ì²œê³µí•­ ìš´í•­í˜„í™© PBB_MT",
    page_icon="âœˆï¸",
    layout="wide",
)

# CSS ìŠ¤íƒ€ì¼ ì ìš©
st.markdown(ui_styles.CSS, unsafe_allow_html=True)

# í˜ì´ì§€ íƒ€ì´í‹€ (í´ë¦­ ì‹œ í™ˆìœ¼ë¡œ ì´ë™)
st.markdown(
    '<h2 style="font-size:1.4rem;">'
    '<a href="/" target="_self" style="text-decoration:none;color:inherit;">'
    'âœˆï¸ ì¸ì²œê³µí•­ ìš´í•­í˜„í™© PBB_MT</a></h2>',
    unsafe_allow_html=True,
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3) ê³µí†µ ë‚ ì§œ/ì‹œê°„ ë³€ìˆ˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
today = datetime.now(config.KST).date()     # ì˜¤ëŠ˜ ë‚ ì§œ (KST ê¸°ì¤€)
now = datetime.now(config.KST)              # í˜„ì¬ ì‹œê° (KST ê¸°ì¤€)
min_date = today + timedelta(days=-3)       # ì¡°íšŒ ê°€ëŠ¥ ìµœì†Œ ë‚ ì§œ (3ì¼ ì „)
max_date = today + timedelta(days=6)        # ì¡°íšŒ ê°€ëŠ¥ ìµœëŒ€ ë‚ ì§œ (6ì¼ í›„)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4) íƒ­ êµ¬ì„± ë° ë Œë”ë§
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tab1, tab2 = st.tabs(["ğŸ›¬ ê²Œì´íŠ¸ ì¶œë„ì°© ì¡°íšŒ", "ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ"])

# íƒ­1: ê²Œì´íŠ¸(ì£¼ê¸°ì¥) ë²ˆí˜¸ë¡œ ì¶œë„ì°© í•­ê³µí¸ ì¡°íšŒ
ui_gate_search.render(tab1, today, now, min_date, max_date)

# íƒ­2: ë‚ ì§œ ë²”ìœ„ ì„ íƒ â†’ í„°ë¯¸ë„ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
ui_excel_download.render(tab2, today, min_date, max_date)
